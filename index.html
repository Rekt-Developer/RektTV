<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced IPTV Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        .channel-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 20px;
        }
        .channel {
            background-color: #1f1f1f;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            width: 200px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .channel img {
            width: 100%;
            border-radius: 5px;
        }
        .channel h2 {
            font-size: 16px;
            margin: 10px 0;
        }
        .channel a {
            color: #1e90ff;
            text-decoration: none;
        }
        .loading {
            text-align: center;
            font-size: 18px;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <h1>Advanced IPTV Player</h1>
    <div class="loading" id="loading">Loading channels...</div>
    <div class="channel-container" id="channelContainer"></div>

    <script>
        const m3uUrl = "https://gitlab.com/-/snippets/2494570/raw/main/free%20channels.m3u";

        // Fetch the M3U file
        async function fetchM3U(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error("Failed to fetch M3U file");
            }
            return response.text();
        }

        // Parse M3U content into channel objects
        function parseM3U(data) {
            const channels = [];
            const lines = data.split("\n");
            let currentChannel = {};

            lines.forEach((line) => {
                if (line.startsWith("#EXTINF:")) {
                    const info = line.match(/tvg-logo="(.*?)".*?,(.*)/);
                    currentChannel.logo = info ? info[1] : "";
                    currentChannel.name = info ? info[2].trim() : "Unknown Channel";
                } else if (line.startsWith("http")) {
                    currentChannel.url = line.trim();
                    channels.push(currentChannel);
                    currentChannel = {};
                }
            });

            return channels;
        }

        // Validate channel streams
        async function validateChannels(channels) {
            const validChannels = [];
            for (const channel of channels) {
                try {
                    const response = await fetch(channel.url, { method: "HEAD" });
                    if (response.ok) {
                        validChannels.push(channel);
                    }
                } catch (error) {
                    console.warn(`Channel ${channel.name} is invalid: ${error.message}`);
                }
            }
            return validChannels;
        }

        // Render channels to the DOM
        function renderChannels(channels) {
            const container = document.getElementById("channelContainer");
            container.innerHTML = ""; // Clear loading text or previous content

            if (channels.length === 0) {
                container.innerHTML = "<p>No valid channels found.</p>";
                return;
            }

            channels.forEach((channel) => {
                const channelElement = document.createElement("div");
                channelElement.className = "channel";
                channelElement.innerHTML = `
                    <img src="${channel.logo}" alt="${channel.name}">
                    <h2>${channel.name}</h2>
                    <a href="${channel.url}" target="_blank">Watch Now</a>
                `;
                container.appendChild(channelElement);
            });
        }

        // Main function
        async function main() {
            try {
                const m3uData = await fetchM3U(m3uUrl);
                const channels = parseM3U(m3uData);
                const validChannels = await validateChannels(channels);
                renderChannels(validChannels);
            } catch (error) {
                document.getElementById("channelContainer").innerHTML = `
                    <p style="color: red;">Error loading channels: ${error.message}</p>
                `;
            } finally {
                document.getElementById("loading").style.display = "none";
            }
        }

        main();
    </script>
</body>
</html>
